const {expect} = require('chai')
const db = require('../db')
const Product = db.model('product')
const supertest = require('supertest')
const sinon = require('sinon')
const app = require('../index')

describe('SingleProduct route', () => {
  const product = {
    title: 'Windows',
    description: 'A computer wallpaper',
    price: 40,
    imageUrl:
      'data:image/jpeg;base64,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',
    totalDownloads: 18,
    likes: 94,
    tags: ['hot', 'awesome']
  }
  describe('/api/products/:productId', () => {
    const {findAll: productFindAll} = Product
    beforeEach(() => {
      // return db.sync({force: true})
      Product.findAll = sinon.spy(() => Promise.resolve(product))
    })

    afterEach(() => {
      Product.findAll = productFindAll
    })

    it('GET /api/products/:productId', async () => {
      const response = await supertest(app).get(`/api/products/${product.id}`)
      expect(response.body).to.deep.equal(product)
    })
  })
})
